{% extends "base.html" %}
{% load static %}
{% block head %}
    <link rel="stylesheet" href="{% static 'formSubmission.css' %}">
    <link rel="stylesheet" href="{% static 'search.css' %}">
{% endblock %}

{% block title %}Claim{% endblock %} {% block content %}
{% csrf_token %}
<div class="d-grid gap-3 container">
    <div id="course_options">
        {% include 'course_options.html' %}
    </div>
    <div class="row">
        <div id="courseMultiSelect"></div>    
    </div>
</div> 
<div class="p-2" id="professorControls">
    <input type="checkbox" class="form-check-input" name="fits" id="fits" checked>
    <label for="fits">Fits in Schedule</label>
    <input type="checkbox" class="form-check-input" name="available" id="available" checked>
    <label for="available">Is available</label>
</div>
<div class="container p-2">
    <div class="row">
        <div class="col center">
            <label>Exclude certain times:</label>
            <select id="day">
                {% for day_code, day in days %}
                    <option value="{{ day_code }}">{{ day }}</option>
                {% endfor %}
            </select>
            <label for="startTime">Start Time</label>
            <input type="time" id="startTime"  min="00:00" max="23:59">
            <label for="endTime">End Time</label>
            <input type="time" id="endTime"  min="00:00" max="23:59">
            <button type="button" id="excludeButton">Exclude Time</button>
        </div>
    </div>
    <div class="row" id="exclusionTimes">

    </div>
</div>
<div class="p-2" 
    hx-include="#courseMultiSelect, #term, #professorControls" 
    hx-target="#sections"
>
    <div class="row">
        <h4 class="col-3 text-center">Section Search:</h4>
        <div class="col-6 search-container">
            <input 
                hx-get="{% url 'get_course_results' offset=0%}" 
                hx-target="#course-options"
                hx-trigger="keyup changed delay:250ms, search" 
                name="course_query" 
                placeholder="Course Title or Number"
                type="text" 
                class="form-control"
                id="course-text" value="{{ course_query }}">
            </input>
            <div class="live-search-results" id="course-search-results">
                <div class="container" id="course-options">
                    {% include 'course_results.html' with offset=0 next_offset=courses|length %}
                </div>
            </div>
        </div>
        <div class="col-3">
            <button
                hx-get="{% url 'section_search' %}"
                class="cursor-pointer search-icon-link" id="meetingSearch">
                Search
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                </svg>
            </button>
        </div>
    </div>
    <div id="sections"></div>
</div>

<!-- Modal to submit a claim for a section/ particular meetings-->
<div class="modal fade" id="submitClaim" tabindex="-1" aria-labelledby="claimLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="claimLabel">Claim</span></h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div class="mb-2">Meeting times:</div>
            <div class="mb-3" id="claimMeetings">
                
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" id="claimButton" class="btn btn-primary">Claim</button>
        </div>
      </div>
    </div>
  </div>

<script>
    const courseText = document.getElementById('course-text');
    const courseSearchResults = document.getElementById('course-search-results');
    courseText.addEventListener('focus', () => {
        courseSearchResults.style.display = 'block';
    });
    courseText.addEventListener('blur', () => {
        setTimeout(() => {
            courseSearchResults.style.display = 'none';
        }, 100);
    });
</script>

{% endblock %}
{% block scripts %}
    <script src={% static 'message.js' %}></script> 
{% endblock %}
