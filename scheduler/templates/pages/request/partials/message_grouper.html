<div id="messageGroup{{ message_group.grouper }}" class="carousel slide">
  <div class="carousel-indicators bg-secondary rounded opacity-50">
    {% for message_bundle in message_group.list %}
    <button type="button" data-bs-target="#messageGroup{{ message_group.grouper }}" data-bs-slide-to="{{ forloop.counter0 }}" class="active" aria-current="true" aria-label="Slide {{ forloop.counter }}"></button>
    {% endfor %}
  </div>
  <div class="carousel-inner">
    {% for message_bundle in message_group.list %}
    <div class="carousel-item {% if forloop.first %}active{% endif%}">
      <div class="card text-center mb-5 border-2 d-block w-100 {{ message_bundle.get_border_class }}">
        {% if not message_bundle.is_read %}
        <div
          hx-trigger="revealed"
          hx-put="{% url 'read_bundle' %}"
          hx-vals='"messageBundle": "{{ message_bundle.pk }}"'>
        </div>
        {% endif %}
        <div class="card-header {{ message_bundle.get_background_class }}">
          {% if not forloop.first %}<span class="fst-italic">(Previous)</span>{% endif %}
          {{ message_bundle.status|title }} changes from {{ message_bundle.sender }}. ID # {{ message_bundle.request_pk }}
          {% if message_bundle.request %}
          <svg 
            hx-post="{% url 'soft_approve' %}"
            hx-swap="none"
            hx-vals='"requestBundle": "{{ message_bundle.request.pk }}"'
            data-bs-toggle="modal" 
            data-bs-target="#warnings"

            class="ms-2 float-end obi bi-check-circle"
            style="cursor: pointer;" 
            xmlns="http://www.w3.org/2000/svg" 
            width="30" 
            height="30" 
            fill="green" 
            viewBox="0 0 16 16">
            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
            <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
          </svg>
          <svg 
            hx-put="{% url 'cancel_request' %}"
            hx-swap="none"
            hx-confirm="Are you sure you want to cancel the request?"
            hx-vals='"messageBundle": "{{ message_bundle.pk }}"'
            style="cursor: pointer;" 

            xmlns="http://www.w3.org/2000/svg" 
            width="30" 
            height="30" 
            fill="red" 
            class="float-end bi bi-x-circle" 
            viewBox="0 0 16 16">
            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
          </svg>
          {% endif %}
        </div>
        <div class="card-body">
          <p class="card-text">
            <div class="container">
              {% regroup message_bundle.messages_sorted.all by section as messages_by_section %}
              {% for messages in messages_by_section %}
                <div class="row fw-bold">
                  <div class="col">
                    {{ messages.grouper }}
                  </div>
                </div>
                {% for message in messages.list %}
                  {% with is_changed=message.is_changed %}
                  <div class="row{% if is_changed %} fst-italic{% endif %}">
                    <div class="col-4">{{ message.get_new_start_time }} - {{ message.get_new_end_time }}</div>
                    <div class="col-1">{{ message.new_day }}</div>
                    <div class="col-3">{{ message.new_room }}</div>
                    <div class="col-3">{{ message.new_professor }}</div>
                    <div class="col-1">
                      <button 
                        class="btn btn-sm btn-outline-secondary" 
                        type="button" 
                        data-bs-toggle="collapse" 
                        data-bs-target="#oldToggle{{ message.pk }}" 
                        aria-expanded="false" 
                        aria-controls="collapseExample"
                        {% if not is_changed %}disabled{% endif %}>
                    
                        Old
                      </button>
                    </div>
                  </div>
                  {% if is_changed %}
                  <div class="row collapse" id="oldToggle{{ message.pk }}">
                    <div class="col-4">{{ message.get_old_start_time }} - {{ message.get_old_end_time }}</div>
                    <div class="col-1">{{ message.old_day }}</div>
                    <div class="col-3">{{ message.old_room }}</div>
                    <div class="col-3">{{ message.old_professor }}</div>
                  </div>
                  {% endif %}
                  {% endwith %}
                {% endfor %}
              {% endfor %}
              </div>
            </p>
        </div>
        <div class="card-footer text-body-secondary {{ message_bundle.get_background_class }}">
          <small>{{ message_bundle.messages.first.section.term }} | {{ message_bundle.date_sent.date }} </small>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  <button class="position-absolute top-50 start-0 translate-middle carousel-control-prev h-25" type="button" data-bs-target="#messageGroup{{ message_group.grouper }}" data-bs-slide="prev">
    <span class="carousel-control-prev-icon bg-secondary" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="position-absolute top-50 start-100 translate-middle h-25 carousel-control-next" type="button" data-bs-target="#messageGroup{{ message_group.grouper }}" data-bs-slide="next">
    <span class="carousel-control-next-icon bg-secondary" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>